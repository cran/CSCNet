<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>CSCNet vignette</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">CSCNet vignette</h1>



<style>
body {
text-align: justify}
</style>
<p>CSCNet is package with flexible tools for fitting and evaluating
cause-specific cox models with elastic-net penalty. Each cause is
modeled in a separate penalized cox model (using elastic-net penalty)
with its exclusive <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\lambda\)</span> assuming other involved competing
causes as censored.</p>
<div id="regularized-cause-specific-cox-and-absolute-risk-predictions" class="section level3">
<h3>Regularized cause-specific cox and absolute risk predictions</h3>
<p>In this package we will use <code>Melanoma</code> data from
‘riskRegression’ package (which will load up with ‘CSCNet’) so we start
by loading the package and the <code>Melanoma</code> data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(CSCNet)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(riskRegression)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">data</span>(Melanoma)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">as_tibble</span>(Melanoma)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># A tibble: 205 × 11</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    time status event     invasion ici   epicel ulcer thick sex     age logthick</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>   <span class="sc">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>fct<span class="sc">&gt;</span>     <span class="er">&lt;</span>fct<span class="sc">&gt;</span>    <span class="er">&lt;</span>fct<span class="sc">&gt;</span> <span class="er">&lt;</span>fct<span class="sc">&gt;</span>  <span class="er">&lt;</span>fct<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>fct<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a> <span class="dv">1</span>    <span class="dv">10</span>      <span class="dv">2</span> death.ot… level<span class="fl">.1</span>  <span class="dv">2</span>     prese… pres…  <span class="fl">6.76</span> Male     <span class="dv">76</span>    <span class="fl">1.91</span> </span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a> <span class="dv">2</span>    <span class="dv">30</span>      <span class="dv">2</span> death.ot… level<span class="fl">.0</span>  <span class="dv">0</span>     not p… not …  <span class="fl">0.65</span> Male     <span class="dv">56</span>   <span class="sc">-</span><span class="fl">0.431</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a> <span class="dv">3</span>    <span class="dv">35</span>      <span class="dv">0</span> censored  level<span class="fl">.1</span>  <span class="dv">2</span>     not p… not …  <span class="fl">1.34</span> Male     <span class="dv">41</span>    <span class="fl">0.293</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a> <span class="dv">4</span>    <span class="dv">99</span>      <span class="dv">2</span> death.ot… level<span class="fl">.0</span>  <span class="dv">2</span>     not p… not …  <span class="fl">2.9</span>  Fema…    <span class="dv">71</span>    <span class="fl">1.06</span> </span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a> <span class="dv">5</span>   <span class="dv">185</span>      <span class="dv">1</span> death.ma… level<span class="fl">.2</span>  <span class="dv">2</span>     prese… pres… <span class="fl">12.1</span>  Male     <span class="dv">52</span>    <span class="fl">2.49</span> </span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a> <span class="dv">6</span>   <span class="dv">204</span>      <span class="dv">1</span> death.ma… level<span class="fl">.2</span>  <span class="dv">2</span>     not p… pres…  <span class="fl">4.84</span> Male     <span class="dv">28</span>    <span class="fl">1.58</span> </span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a> <span class="dv">7</span>   <span class="dv">210</span>      <span class="dv">1</span> death.ma… level<span class="fl">.2</span>  <span class="dv">2</span>     prese… pres…  <span class="fl">5.16</span> Male     <span class="dv">77</span>    <span class="fl">1.64</span> </span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a> <span class="dv">8</span>   <span class="dv">232</span>      <span class="dv">1</span> death.ma… level<span class="fl">.2</span>  <span class="dv">2</span>     not p… pres… <span class="fl">12.9</span>  Male     <span class="dv">49</span>    <span class="fl">2.56</span> </span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a> <span class="dv">9</span>   <span class="dv">232</span>      <span class="dv">2</span> death.ot… level<span class="fl">.1</span>  <span class="dv">3</span>     not p… pres…  <span class="fl">3.22</span> Fema…    <span class="dv">60</span>    <span class="fl">1.17</span> </span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="dv">10</span>   <span class="dv">279</span>      <span class="dv">1</span> death.ma… level<span class="fl">.0</span>  <span class="dv">2</span>     not p… pres…  <span class="fl">7.41</span> Fema…    <span class="dv">68</span>    <span class="fl">2.00</span> </span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co"># ℹ 195 more rows</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="fu">table</span>(Melanoma<span class="sc">$</span>status)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>  <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span> </span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="dv">134</span>  <span class="dv">57</span>  <span class="dv">14</span> </span></code></pre></div>
<p>There are 2 events in the Melanoma data coded as 1 &amp; 2. To
introduce how setting up variables and hyper-parameters works in CSCNet,
we will fit the a model with the following hyper-parameters to the
<code>Melanoma</code> data: <span class="math display">\[(\alpha_{1},\alpha_{2},\lambda_{1},\lambda_{2})=(0,0.5,0.01,0.02)\]</span>
We set variables affecting the event: 1 as
<code>age,sex,invasion,thick</code> and variables affecting event: 2 as
<code>age,sex,epicel,ici,thick</code>.</p>
<div id="fitting-regularized-cause-specific-cox-models" class="section level4">
<h4>Fitting regularized cause-specific cox models</h4>
<p>In CSCNet, setting variables and hyper-parameters are done through
named lists. Variables and hyper-parameters related to each involved
cause are stored in list positions with the name of that position being
that cause. Of course these names must be the same as values in the
status variable in the data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>vl <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;age&#39;</span>,<span class="st">&#39;sex&#39;</span>,<span class="st">&#39;invasion&#39;</span>,<span class="st">&#39;thick&#39;</span>),</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>     </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>     <span class="st">&#39;2&#39;</span><span class="ot">=</span><span class="er">~</span>age<span class="sc">+</span>sex<span class="sc">+</span>epicel<span class="sc">+</span>ici<span class="sc">+</span>thick)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>penfit <span class="ot">&lt;-</span> <span class="fu">penCSC</span>(<span class="at">time =</span> <span class="st">&#39;time&#39;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>                 </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>                 <span class="at">status =</span> <span class="st">&#39;status&#39;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>                 </span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>                 <span class="at">vars.list =</span> vl,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>                 </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>                 <span class="at">data =</span> Melanoma,</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>                 </span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>                 <span class="at">alpha.list =</span> <span class="fu">list</span>(<span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">0</span>,<span class="st">&#39;2&#39;</span><span class="ot">=</span>.<span class="dv">5</span>),</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>                 </span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>                 <span class="at">lambda.list =</span> <span class="fu">list</span>(<span class="st">&#39;1&#39;</span><span class="ot">=</span>.<span class="dv">01</span>,<span class="st">&#39;2&#39;</span><span class="ot">=</span>.<span class="dv">02</span>))</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>penfit</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">Event: 1</span><span class="st">`</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="dv">5</span> x <span class="dv">1</span> sparse Matrix of class <span class="st">&quot;dgCMatrix&quot;</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>                          <span class="dv">1</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>age             <span class="fl">0.008018578</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>sexMale         <span class="fl">0.547580959</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>invasionlevel<span class="fl">.1</span> <span class="fl">0.756922406</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>invasionlevel<span class="fl">.2</span> <span class="fl">0.591044240</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>thick           <span class="fl">0.118568171</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">Event: 2</span><span class="st">`</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="dv">7</span> x <span class="dv">1</span> sparse Matrix of class <span class="st">&quot;dgCMatrix&quot;</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>                        <span class="dv">1</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>age            <span class="fl">0.04839997</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>sexMale        <span class="fl">0.11419057</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>epicelpresent  <span class="fl">0.16891622</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>ici1          <span class="sc">-</span><span class="fl">0.13501846</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>ici2           .         </span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>ici3           .         </span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>thick          <span class="fl">0.03242932</span></span></code></pre></div>
<p><code>penfit</code> is a comprehensive list with all information
related to the data and fitted models in detail that user can
access.</p>
<p><strong>Note:</strong> As we saw, variable specification in
<code>vars.list</code> is possible in 2 ways which are introducing a
vector of variable names or a one hand sided formula for different
causes.</p>
</div>
<div id="predictions-and-semi-parametric-estimates-of-absolute-risk" class="section level4">
<h4>Predictions and semi-parametric estimates of absolute risk</h4>
<p>Now to obtain predictions, specially estimates of the absolute risks,
<code>predict.penCSC</code> method was developed so user can obtain
different forms of values in the easiest way possible. By this method on
objects of class <code>penCSCS</code> and for different involved causes,
user can obtain values for linear predictors (<code>type=&#39;lp&#39;</code> or
<code>type=&#39;link&#39;</code>), exponential of linear predictors
(<code>type=&#39;risk&#39;</code> or <code>type=&#39;response&#39;</code>) and finally
semi-parametric estimates of absolute risks
(<code>type=&#39;absRisk&#39;</code>) at desired time horizons.</p>
<p><strong>Note:</strong> Default value for <code>event</code> argument
in <code>predict.penCSC</code> is <code>NULL</code>. If user leaves it
as that, values for all involved causes will be returned.</p>
<p>Values of linear predictors for event: 1 related to 1st five
individuals of the data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">predict</span>(penfit,Melanoma[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,],<span class="at">type=</span><span class="st">&#39;lp&#39;</span>,<span class="at">event=</span><span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># A tibble: 5 × 3</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>     id event prediction</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">1</span> <span class="dv">1</span>          <span class="fl">2.72</span> </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="dv">2</span>     <span class="dv">2</span> <span class="dv">1</span>          <span class="fl">1.07</span> </span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">3</span> <span class="dv">1</span>          <span class="fl">1.79</span> </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="dv">4</span>     <span class="dv">4</span> <span class="dv">1</span>          <span class="fl">0.913</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="dv">5</span>     <span class="dv">5</span> <span class="dv">1</span>          <span class="fl">2.99</span> </span></code></pre></div>
<p>Or the risk values of the same individuals for all involved
causes:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">predict</span>(penfit,Melanoma[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,],<span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># A tibble: 10 × 3</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>      id event prediction</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>   <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a> <span class="dv">1</span>     <span class="dv">1</span> <span class="dv">1</span>          <span class="fl">15.1</span> </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a> <span class="dv">2</span>     <span class="dv">2</span> <span class="dv">1</span>           <span class="fl">2.93</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a> <span class="dv">3</span>     <span class="dv">3</span> <span class="dv">1</span>           <span class="fl">6.00</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a> <span class="dv">4</span>     <span class="dv">4</span> <span class="dv">1</span>           <span class="fl">2.49</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a> <span class="dv">5</span>     <span class="dv">5</span> <span class="dv">1</span>          <span class="fl">19.8</span> </span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a> <span class="dv">6</span>     <span class="dv">1</span> <span class="dv">2</span>          <span class="fl">65.4</span> </span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a> <span class="dv">7</span>     <span class="dv">2</span> <span class="dv">2</span>          <span class="fl">17.2</span> </span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a> <span class="dv">8</span>     <span class="dv">3</span> <span class="dv">2</span>           <span class="fl">8.52</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a> <span class="dv">9</span>     <span class="dv">4</span> <span class="dv">2</span>          <span class="fl">34.1</span> </span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="dv">10</span>     <span class="dv">5</span> <span class="dv">2</span>          <span class="fl">24.3</span> </span></code></pre></div>
<p>Now let’s say we want estimates of absolute risks related to the
event: 1 as our event of interest at 3 and 5 year time horizons:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">predict</span>(penfit,Melanoma[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,],<span class="at">type=</span><span class="st">&#39;absRisk&#39;</span>,<span class="at">event=</span><span class="dv">1</span>,<span class="at">time=</span><span class="dv">365</span><span class="sc">*</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># A tibble: 10 × 4</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>      id event horizon absoluteRisk</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>   <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>   <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>        <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a> <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1095</span>       <span class="fl">0.374</span> </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a> <span class="dv">2</span>     <span class="dv">2</span>     <span class="dv">1</span>    <span class="dv">1095</span>       <span class="fl">0.0952</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a> <span class="dv">3</span>     <span class="dv">3</span>     <span class="dv">1</span>    <span class="dv">1095</span>       <span class="fl">0.187</span> </span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a> <span class="dv">4</span>     <span class="dv">4</span>     <span class="dv">1</span>    <span class="dv">1095</span>       <span class="fl">0.0798</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a> <span class="dv">5</span>     <span class="dv">5</span>     <span class="dv">1</span>    <span class="dv">1095</span>       <span class="fl">0.480</span> </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a> <span class="dv">6</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1825</span>       <span class="fl">0.525</span> </span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a> <span class="dv">7</span>     <span class="dv">2</span>     <span class="dv">1</span>    <span class="dv">1825</span>       <span class="fl">0.153</span> </span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a> <span class="dv">8</span>     <span class="dv">3</span>     <span class="dv">1</span>    <span class="dv">1825</span>       <span class="fl">0.292</span> </span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a> <span class="dv">9</span>     <span class="dv">4</span>     <span class="dv">1</span>    <span class="dv">1825</span>       <span class="fl">0.128</span> </span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="dv">10</span>     <span class="dv">5</span>     <span class="dv">1</span>    <span class="dv">1825</span>       <span class="fl">0.654</span> </span></code></pre></div>
<p><strong>Note:</strong> There’s also <code>predictRisk.penCSC</code>
to obtain absolute risk predictions. This method was developed for
compatibility with tools from ‘riskRegression’ package.</p>
</div>
</div>
<div id="tuning-the-hyper-parameters" class="section level3">
<h3>Tuning the hyper-parameters</h3>
<p>The above example was for illustration purposes. In real world
analysis, one must tune the hyper-parameters with respect to a proper
loss function through resampling procedures. <code>tune_penCSC</code> is
a comprehensive function that was built for this purpose on regularized
cause-specific cox models.</p>
<p>Like before, specification of variables and hyper-parameters are done
through named lists and sequences of candidate hyper-parameters related
to each involved cause are stored in list positions with the name of
that position being that cause. After that, <code>tune_penCSC</code>
will create all possible combinations from user’s specified sequences
and evaluates them using either IPCW brier score or IPCW AUC (as loss
functions) based on absolute risk predictions of the event of interest
(linking) through a chosen resampling process. Supported resampling
procedures are: cross validation (<code>method=&#39;cv&#39;</code>), repeated
cross validation (<code>method=&#39;repcv&#39;</code>), bootstrap
(<code>method=&#39;boot&#39;</code>), Monte-Carlo or leave group out cross
validation (<code>method=&#39;lgocv&#39;</code>) and leave one out cross
validation (<code>method=&#39;loocv&#39;</code>).</p>
<div id="automatic-specification-of-hyper-parameters-sequences" class="section level4">
<h4>Automatic specification of hyper-parameters sequences</h4>
<p><code>tune_penCSC</code> has the ability to automatically determine
the candidate sequences of <span class="math inline">\(\alpha\)</span>
&amp; <span class="math inline">\(\lambda\)</span> values. Setting any
of <code>alpha.grid</code> &amp; <code>lambda.grid</code> to
<code>NULL</code> will order the function to calculate them
automatically.</p>
<p>While the automatic sequence of <span class="math inline">\(\alpha\)</span> values for all causes is
<code>seq(0,1,.5)</code>, the process of determining the <span class="math inline">\(\lambda\)</span> values automatically is by:</p>
<ol style="list-style-type: decimal">
<li>The algorithm fits LASSO models until finding a <span class="math inline">\(\lambda\)</span> value that creates a NULL model
where all variables were shrunk to be exactly 0. The path to reach
maximum <span class="math inline">\(\lambda\)</span> is specified
internally by <code>glmnet</code>.</li>
<li>The obtained <span class="math inline">\(\lambda\)</span> value will
be used as the maximum value of a sequence starting from 0. The length
of this sequence is controlled by values in
<code>nlambdas.list</code>.</li>
</ol>
<p>This will be done for each cause-specific model to create exclusive
sequences of <span class="math inline">\(\lambda\)</span>s for each of
them.</p>
</div>
<div id="pre-processing-within-resampling" class="section level4">
<h4>Pre-processing within resampling</h4>
<p>If the data requires pre-processing steps, it must be done within the
resampling process to avoid data leakage. This can be achieved by using
<code>preProc.fun</code> argument of <code>tune_penCSC</code> function.
This arguments accepts a function that has a data as its only input and
returns a modified version of that data. Any pre-processing steps can be
specified within this function.</p>
<p><strong>Note:</strong> <code>tune_penCSC</code> has the parallel
processing option. If a user has specified a function for pre-processing
steps with global objects or calls from other packages and wants to run
the code in parallel, the names of those extra packages and global
objects must be given through <code>preProc.pkgs</code> and
<code>preProc.globals</code>.</p>
<p>Now let’s see all that was mentioned in this section in an example.
Let’s say we want to tune our model for 5 year absolute risk prediction
of event: 1 based on time dependent (IPCW) AUC as the loss function
(evaluation metric) through a 5-fold cross validation process:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">#A pre-processing function that removes (near) zero-variance predictors</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&#39;collinear&#39;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>zvr.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  zv_vars <span class="ot">&lt;-</span> <span class="fu">identify_zero_variance_variables</span>(<span class="at">df =</span> data,<span class="at">responses =</span> <span class="fu">c</span>(<span class="st">&#39;time&#39;</span>,<span class="st">&#39;status&#39;</span>))</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">return</span>(data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(zv_vars)))</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>}</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#Tuning a regularized cause-specific Cox model</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>tune_melanoma <span class="ot">&lt;-</span> <span class="fu">tune_penCSC</span>(<span class="at">time =</span> <span class="st">&#39;time&#39;</span>,</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>                             </span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>                             <span class="at">status =</span> <span class="st">&#39;status&#39;</span>,</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>                             </span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>                             <span class="at">vars.list =</span> vl,</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>                             </span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>                             <span class="at">data =</span> Melanoma,</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>                             </span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>                             <span class="at">horizons =</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>,</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>                             </span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>                             <span class="at">event =</span> <span class="dv">1</span>,</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>                             </span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>                             <span class="at">method =</span> <span class="st">&#39;cv&#39;</span>,</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>                             </span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>                             <span class="at">k =</span> <span class="dv">3</span>,</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>                             </span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>                             <span class="at">metrics =</span> <span class="st">&#39;AUC&#39;</span>,</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>                             </span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>                             <span class="at">alpha.grid =</span> <span class="fu">list</span>(<span class="st">&#39;1&#39;</span><span class="ot">=</span><span class="dv">0</span>,<span class="st">&#39;2&#39;</span><span class="ot">=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>)),</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>                             </span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>                             <span class="at">preProc.fun =</span> zvr.fun,</span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>                             </span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>                             <span class="at">parallel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a>                             </span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>                             <span class="at">preProc.pkgs =</span> <span class="st">&#39;collinear&#39;</span>)</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>Process was done <span class="cf">in</span> <span class="fl">17.55281</span> secs.</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a>tune_melanoma<span class="sc">$</span>validation_result <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mean.AUC)) <span class="sc">%&gt;%</span> head</span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>  alpha_1 alpha_2  lambda_1   lambda_2 horizon  mean.AUC</span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">0</span>     <span class="fl">1.0</span> <span class="fl">0.1266803</span> <span class="fl">0.06461658</span>    <span class="dv">1095</span> <span class="fl">0.7582999</span></span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">0</span>     <span class="fl">0.5</span> <span class="fl">0.1266803</span> <span class="fl">0.06461658</span>    <span class="dv">1095</span> <span class="fl">0.7576485</span></span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a><span class="dv">3</span>       <span class="dv">0</span>     <span class="fl">1.0</span> <span class="fl">0.1689070</span> <span class="fl">0.06461658</span>    <span class="dv">1095</span> <span class="fl">0.7572174</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">0</span>     <span class="fl">0.5</span> <span class="fl">0.1689070</span> <span class="fl">0.04846244</span>    <span class="dv">1095</span> <span class="fl">0.7571937</span></span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a><span class="dv">5</span>       <span class="dv">0</span>     <span class="fl">1.0</span> <span class="fl">0.1266803</span> <span class="fl">0.04846244</span>    <span class="dv">1095</span> <span class="fl">0.7571072</span></span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a><span class="dv">6</span>       <span class="dv">0</span>     <span class="fl">1.0</span> <span class="fl">0.1689070</span> <span class="fl">0.04846244</span>    <span class="dv">1095</span> <span class="fl">0.7565659</span></span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a>tune_melanoma<span class="sc">$</span>final_params</span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">1095</span><span class="st">`</span></span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a>  alpha_1 alpha_2  lambda_1   lambda_2 horizon  mean.AUC</span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">0</span>       <span class="dv">1</span> <span class="fl">0.1266803</span> <span class="fl">0.06461658</span>    <span class="dv">1095</span> <span class="fl">0.7582999</span></span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" tabindex="-1"></a>tune_melanoma<span class="sc">$</span>final_fits</span>
<span id="cb6-58"><a href="#cb6-58" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">1095</span><span class="st">`</span></span>
<span id="cb6-59"><a href="#cb6-59" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">Event: 1</span><span class="st">`</span></span>
<span id="cb6-60"><a href="#cb6-60" tabindex="-1"></a><span class="dv">5</span> x <span class="dv">1</span> sparse Matrix of class <span class="st">&quot;dgCMatrix&quot;</span></span>
<span id="cb6-61"><a href="#cb6-61" tabindex="-1"></a>                          <span class="dv">1</span></span>
<span id="cb6-62"><a href="#cb6-62" tabindex="-1"></a>age             <span class="fl">0.007295435</span></span>
<span id="cb6-63"><a href="#cb6-63" tabindex="-1"></a>sexMale         <span class="fl">0.401864203</span></span>
<span id="cb6-64"><a href="#cb6-64" tabindex="-1"></a>invasionlevel<span class="fl">.1</span> <span class="fl">0.488273795</span></span>
<span id="cb6-65"><a href="#cb6-65" tabindex="-1"></a>invasionlevel<span class="fl">.2</span> <span class="fl">0.389883810</span></span>
<span id="cb6-66"><a href="#cb6-66" tabindex="-1"></a>thick           <span class="fl">0.103119330</span></span>
<span id="cb6-67"><a href="#cb6-67" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">Event: 2</span><span class="st">`</span></span>
<span id="cb6-69"><a href="#cb6-69" tabindex="-1"></a><span class="dv">7</span> x <span class="dv">1</span> sparse Matrix of class <span class="st">&quot;dgCMatrix&quot;</span></span>
<span id="cb6-70"><a href="#cb6-70" tabindex="-1"></a>              <span class="dv">1</span></span>
<span id="cb6-71"><a href="#cb6-71" tabindex="-1"></a>age           .</span>
<span id="cb6-72"><a href="#cb6-72" tabindex="-1"></a>sexMale       .</span>
<span id="cb6-73"><a href="#cb6-73" tabindex="-1"></a>epicelpresent .</span>
<span id="cb6-74"><a href="#cb6-74" tabindex="-1"></a>ici1          .</span>
<span id="cb6-75"><a href="#cb6-75" tabindex="-1"></a>ici2          .</span>
<span id="cb6-76"><a href="#cb6-76" tabindex="-1"></a>ici3          .</span>
<span id="cb6-77"><a href="#cb6-77" tabindex="-1"></a>thick         .</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
